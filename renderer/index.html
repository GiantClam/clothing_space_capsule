<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>衣等舱 - AI试衣体验</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- 页面容器 -->
    <div id="app">
        
        <!-- 1. 欢迎页面 - 扫码关注 -->
        <div id="welcome-page" class="page active">
            <div class="content-center">
                <div class="logo-section">
                    <div class="logo">衣等舱</div>
                    <div class="subtitle">AI试衣间「一拍即合」</div>
                </div>
                <button class="main-button" onclick="startExperience()">立即体验</button>
                <div style="margin-top:16px">
                    <button class="main-button" onclick="openConfigPage()" style="background:#ffe; color:#764ba2">打开配置</button>
                </div>
                <div class="tips">
                    <p>体验流程说明：只需3分钟，即可看到您的穿搭效果！</p>
                    <p>免费一键试穿，新体验新风尚。</p>
                </div>
                <div class="wechat-qr" id="wechat-qr">
                    <!-- 微信扫码二维码将在这里显示 -->
                    <img src="../public/placeholder-qr.png" alt="扫码关注公众号" id="wechat-qr-img">
                    <p>微信扫码关注公众号，获取专属体验</p>
                </div>
            </div>
        </div>

        <!-- 2. 个人信息页 -->
        <div id="profile-page" class="page">
            <div class="camera-container">
                <video id="camera-video" autoplay playsinline muted></video>
                <canvas id="camera-canvas" style="display: none;"></canvas>
                <div class="camera-overlay">
                    <div class="camera-instructions">
                        <h3>请站在摄像头前拍摄全身照</h3>
                        <p>确保全身都在画面中，光线充足</p>
                    </div>
                    <button class="generate-button floating" onclick="generateTryOn()" id="generate-btn">
                        GENERATE TRY-ON
                    </button>
                </div>
            </div>
        </div>

        <!-- 3. 服装选择页 -->
        <div id="clothing-page" class="page">
            <div class="header">
                <button class="back-button" onclick="goBack()">← 返回</button>
                <h2>服装选择</h2>
            </div>
            
            <!-- 性别选择tab -->
            <div class="gender-tabs">
                <button class="gender-tab active" data-gender="female">女装</button>
                <button class="gender-tab" data-gender="male">男装</button>
            </div>
            
            <!-- 服装分类选择 -->
            <div class="clothing-categories">
                <div class="category-tabs">
                    <button class="tab active" data-category="tops-bottoms">上衣&下衣</button>
                    <button class="tab" data-category="dresses">裙子</button>
                </div>
                
                <!-- 分类互斥提示 -->
                <div class="category-notice" id="category-notice" style="display: none;">
                    <p>⚠️ 裙子与上衣/下衣不能同时选择，选择裙子将自动取消上衣/下衣的选择</p>
                </div>
                
                <!-- 上衣下衣子分类 -->
                <div class="sub-category-tabs" id="sub-category-tabs" style="display: block;">
                    <button class="sub-tab active" data-subcategory="tops">上衣</button>
                    <button class="sub-tab" data-subcategory="bottoms">下衣</button>
                </div>
                
                <div class="clothing-grid" id="clothing-grid">
                    <!-- 服装选项将在此处动态加载 -->
                </div>
            </div>
            
            <div class="selection-summary gold-card">
                <div class="selected-item" id="selected-clothing">
                    <span>尚未选择服装</span>
                </div>
                <button class="continue-button" onclick="proceedToFitting()" disabled id="proceed-btn">
                    继续试穿
                </button>
            </div>
        </div>

        <!-- 4. 拟合结果页 -->
        <div id="results-page" class="page">
            <div class="header">
                <button class="back-button" onclick="goBack()">← 返回</button>
                <h2>试衣效果</h2>
            </div>
            <div class="results-content gold-card" style="background: transparent">
                <div class="result-image-container">
                    <img id="result-image" src="" alt="试衣效果" style="display: none;">
                    <div class="loading-indicator" id="loading-indicator">
                        <div class="spinner"></div>
                        <p>您的时尚偶像好</p>
                        <div class="progress-text" id="progress-text">正在生成中...</div>
                    </div>
                </div>
                <div class="result-actions" id="result-actions" style="display: none;">
                    <button class="action-button secondary" onclick="retryFitting()">重新选择</button>
                    <button class="action-button primary" onclick="saveImage()">保存图片</button>
                </div>
                <div class="style-info" id="style-info" style="display: none;">
                    <div class="style-tag">走秀风</div>
                    <div class="style-tag">时尚海报风</div>
                </div>
            </div>
        </div>

        <!-- 5. 穿搭风格页 -->
        <div id="style-page" class="page">
            <div class="header">
                <button class="back-button" onclick="goBack()">← 返回</button>
                <h2>选择风格</h2>
            </div>
            <div class="style-options">
                <div class="style-description">
                    <p>您的穿搭风格</p>
                    <p>AI为您量身定制，结合潮流与个性的完美呈现</p>
                </div>
                <div class="style-categories">
                    <div class="style-category">
                        <h3>🎯 体形感情</h3>
                        <p>强调个人魅力的经典风格</p>
                    </div>
                    <div class="style-category active">
                        <h3>🌟 商务主妇</h3>
                        <p>简约优雅，适合多种场合</p>
                    </div>
                    <div class="style-category">
                        <h3>💫 温柔洪楼</h3>
                        <p>柔美浪漫，展现女性魅力</p>
                    </div>
                    <div class="style-category">
                        <h3>🎨 温柔滨楼</h3>
                        <p>艺术感十足，个性表达</p>
                    </div>
                    <div class="style-category">
                        <h3>✨ 社交名媛</h3>
                        <p>奢华精致，彰显品味</p>
                    </div>
                </div>
                <button class="confirm-style-button" onclick="confirmStyle()">确认风格</button>
            </div>
        </div>

        <!-- 6. 下载页面 -->
        <div id="download-page" class="page">
            <div class="header">
                <h2>保存效果</h2>
            </div>
            <div class="download-content gold-card">
                <div class="qr-section">
                    <div class="qr-code-container">
                        <canvas id="qr-canvas"></canvas>
                        <div id="qr-loading">生成二维码中...</div>
                    </div>
                    <p>微信扫码下载试衣效果图</p>
                </div>
                <div class="download-info">
                    <p>扫码后可获得：</p>
                    <ul>
                        <li>高清试衣效果图</li>
                        <li>服装购买链接</li>
                        <li>专属优惠信息</li>
                    </ul>
                </div>
                <div class="countdown-section">
                    <div class="countdown" id="countdown">60</div>
                    <p>秒后自动返回首页</p>
                    <button class="back-home-button" onclick="backToCamera()">立即返回照相</button>
                </div>
            </div>
        </div>

        <!-- 7. 配置页面 -->
        <div id="config-page" class="page">
            <div class="header">
                <button class="back-button" onclick="goBack()">← 返回</button>
                <h2>配置</h2>
            </div>
            <div style="padding:20px; overflow:auto">
                <div style="margin-bottom:16px">
                    <h3>RunningHub</h3>
                    <div class="field-group">
                        <label>API Key</label>
                        <input id="cfg-runninghub-apiKey" type="text" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px" />
                    </div>
                    <div class="field-group">
                        <label>Base URL</label>
                        <input id="cfg-runninghub-baseUrl" type="text" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px" />
                    </div>
                    <div class="field-group">
                        <label>单件服装工作流ID (裙子/单上衣)</label>
                        <input id="cfg-runninghub-singleItemWorkflowId" type="text" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px" placeholder="用于裙子或单上衣的工作流ID" />
                    </div>
                    <div class="field-group">
                        <label>上衣+下衣工作流ID</label>
                        <input id="cfg-runninghub-topBottomWorkflowId" type="text" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px" placeholder="用于上衣和下衣组合的工作流ID" />
                    </div>
                </div>
                <div style="margin-bottom:16px">
                    <h3>微信</h3>
                    <div class="field-group">
                        <label>App ID</label>
                        <input id="cfg-wechat-appId" type="text" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px" />
                    </div>
                    <div class="field-group">
                        <label>App Secret</label>
                        <input id="cfg-wechat-appSecret" type="text" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px" />
                    </div>
                    <div class="field-group">
                        <label>Token</label>
                        <input id="cfg-wechat-token" type="text" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px" />
                    </div>
                    <div class="field-group">
                        <label>Encoding AES Key</label>
                        <input id="cfg-wechat-encodingAESKey" type="text" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px" />
                    </div>
                </div>
                <div style="margin-bottom:16px">
                    <h3>服务器</h3>
                    <div class="field-group">
                        <label>Host</label>
                        <input id="cfg-server-host" type="text" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px" />
                    </div>
                    <div class="field-group">
                        <label>Port</label>
                        <input id="cfg-server-port" type="number" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px" />
                    </div>
                    <div class="field-group">
                        <button type="button" onclick="testApiConnection()" style="margin-top:8px; padding:8px 16px; background:#17a2b8; color:white; border:none; border-radius:4px; cursor:pointer;">测试API连接</button>
                        <div id="api-test-result" style="margin-top:8px; padding:8px; border-radius:4px; display:none;"></div>
                    </div>
                </div>
                <div style="margin-bottom:16px">
                    <h3>设备信息</h3>
                    <div class="field-group">
                        <label>MAC地址</label>
                        <input id="cfg-device-mac" type="text" readonly style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px; background-color:#f5f5f5" />
                        <button type="button" onclick="refreshMacAddress()" style="margin-top:8px; padding:4px 8px; background:#007bff; color:white; border:none; border-radius:4px; cursor:pointer;">刷新</button>
                    </div>
                    <div class="field-group">
                        <label>摄像头设备</label>
                        <select id="cfg-camera-device" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px">
                            <option value="">正在加载摄像头设备...</option>
                        </select>
                        <button type="button" onclick="refreshCameraList()" style="margin-top:8px; padding:4px 8px; background:#28a745; color:white; border:none; border-radius:4px; cursor:pointer;">刷新摄像头列表</button>
                        <button type="button" onclick="switchCamera()" style="margin-top:8px; margin-left:8px; padding:4px 8px; background:#ffc107; color:black; border:none; border-radius:4px; cursor:pointer;">切换摄像头</button>
                    </div>
                </div>
                <div>
                    <button class="continue-button" id="cfg-save-btn" onclick="saveConfig()">保存配置</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 通用加载层 -->
    <div id="global-loading" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="spinner large"></div>
            <p id="loading-message">处理中...</p>
        </div>
    </div>

    <!-- 错误提示 -->
    <div id="error-modal" class="modal" style="display: none;">
        <div class="modal-content gold-card">
            <h3>提示</h3>
            <p id="error-message"></p>
            <button onclick="closeErrorModal()">确定</button>
        </div>
    </div>

    <script src="api-client.js"></script>
    <script>
        // 即时检查脚本加载状态
        console.log('🔍 在内联脚本中检查 API 客户端加载状态:');
        console.log('- typeof window.ApiClient:', typeof window.ApiClient);
        console.log('- typeof window.apiClient:', typeof window.apiClient);
        console.log('- window.ApiClient exists:', !!window.ApiClient);
        console.log('- window.apiClient exists:', !!window.apiClient);
        
        if (!window.ApiClient && !window.apiClient) {
            console.error('❌ 内联脚本检查: API客户端未加载');
        } else {
            console.log('✅ 内联脚本检查: API客户端已加载');
        }
    </script>
    <script src="app.js"></script>
</body>
</html>

