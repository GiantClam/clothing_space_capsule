<!DOCTYPE html>
<html>
<head>
    <title>é…ç½®å­˜å‚¨æµ‹è¯•</title>
</head>
<body>
    <h1>é…ç½®å­˜å‚¨æµ‹è¯•</h1>
    
    <div>
        <h2>æµ‹è¯•é…ç½®ä¿å­˜å’ŒåŠ è½½</h2>
        <button onclick="testConfigSave()">æµ‹è¯•ä¿å­˜é…ç½®</button>
        <button onclick="testConfigLoad()">æµ‹è¯•åŠ è½½é…ç½®</button>
        <button onclick="clearConfig()">æ¸…ç©ºé…ç½®</button>
    </div>
    
    <div>
        <h2>å½“å‰é…ç½®</h2>
        <pre id="config-display"></pre>
    </div>
    
    <div>
        <h2>æµ‹è¯•ç»“æœ</h2>
        <div id="test-results"></div>
    </div>

    <script>
        // æ¨¡æ‹ŸAppStateçš„é…ç½®ç®¡ç†
        class TestAppState {
            constructor() {
                this.configCache = null;
            }
            
            getConfig() {
                if (this.configCache) {
                    return this.configCache;
                }
                
                try {
                    const configStr = localStorage.getItem('appConfig');
                    if (configStr) {
                        this.configCache = JSON.parse(configStr);
                        return this.configCache;
                    }
                } catch (error) {
                    console.error('è§£æé…ç½®å¤±è´¥:', error);
                }
                
                return {
                    runninghub: {
                        apiKey: '',
                        baseUrl: 'https://www.runninghub.cn',
                        singleItemWorkflowId: '',
                        topBottomWorkflowId: ''
                    },
                    wechat: {
                        appId: '',
                        appSecret: '',
                        token: '',
                        encodingAESKey: ''
                    },
                    server: {
                        host: 'localhost',
                        port: 3000
                    }
                };
            }
            
            setConfig(config) {
                this.configCache = config;
                localStorage.setItem('appConfig', JSON.stringify(config));
            }
        }
        
        const testAppState = new TestAppState();
        
        function testConfigSave() {
            const testConfig = {
                runninghub: {
                    apiKey: 'test-api-key-123',
                    baseUrl: 'https://www.runninghub.cn',
                    singleItemWorkflowId: 'single-workflow-123',
                    topBottomWorkflowId: 'top-bottom-workflow-456'
                },
                wechat: {
                    appId: 'test-app-id',
                    appSecret: 'test-secret',
                    token: 'test-token',
                    encodingAESKey: 'test-aes-key'
                },
                server: {
                    host: 'localhost',
                    port: 3000
                }
            };
            
            testAppState.setConfig(testConfig);
            document.getElementById('test-results').innerHTML = '<p style="color: green;">âœ… é…ç½®ä¿å­˜æˆåŠŸ</p>';
            displayConfig();
        }
        
        function testConfigLoad() {
            const config = testAppState.getConfig();
            const hasSingleItem = config.runninghub.singleItemWorkflowId === 'single-workflow-123';
            const hasTopBottom = config.runninghub.topBottomWorkflowId === 'top-bottom-workflow-456';
            
            if (hasSingleItem && hasTopBottom) {
                document.getElementById('test-results').innerHTML = '<p style="color: green;">âœ… é…ç½®åŠ è½½æˆåŠŸï¼Œä¸¤ä¸ªå·¥ä½œæµIDéƒ½æ­£ç¡®</p>';
            } else {
                document.getElementById('test-results').innerHTML = '<p style="color: red;">âŒ é…ç½®åŠ è½½å¤±è´¥</p>';
            }
            displayConfig();
        }
        
        function clearConfig() {
            localStorage.removeItem('appConfig');
            testAppState.configCache = null;
            document.getElementById('test-results').innerHTML = '<p style="color: blue;">ğŸ—‘ï¸ é…ç½®å·²æ¸…ç©º</p>';
            displayConfig();
        }
        
        function displayConfig() {
            const config = testAppState.getConfig();
            document.getElementById('config-display').textContent = JSON.stringify(config, null, 2);
        }
        
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå½“å‰é…ç½®
        displayConfig();
    </script>
</body>
</html>
