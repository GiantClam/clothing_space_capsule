<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIå®¢æˆ·ç«¯åŠ è½½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #ccc;
        }
        .success {
            background-color: #e8f5e8;
            border-left-color: #4caf50;
        }
        .error {
            background-color: #ffeaea;
            border-left-color: #f44336;
        }
        .warning {
            background-color: #fff3cd;
            border-left-color: #ff9800;
        }
        #log {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>APIå®¢æˆ·ç«¯åŠ è½½æµ‹è¯•</h1>
        <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•api-client.jsæ˜¯å¦èƒ½æ­£ç¡®åŠ è½½</p>
        
        <div id="results"></div>
        
        <h3>è¯¦ç»†æ—¥å¿—</h3>
        <div id="log"></div>
        
        <button onclick="runTests()">é‡æ–°è¿è¡Œæµ‹è¯•</button>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <!-- æŒ‰ç…§ä¸»åº”ç”¨çš„åŠ è½½é¡ºåº -->
    <script src="api-client.js"></script>
    
    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function showResult(message, type = 'success') {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `status ${type}`;
            resultDiv.innerHTML = message;
            resultsDiv.appendChild(resultDiv);
        }

        function clearLog() {
            document.getElementById('log').textContent = '';
            document.getElementById('results').innerHTML = '';
        }

        function runTests() {
            clearLog();
            log('ğŸš€ å¼€å§‹APIå®¢æˆ·ç«¯åŠ è½½æµ‹è¯•...');
            
            // æµ‹è¯•1: æ£€æŸ¥windowå¯¹è±¡ä¸­çš„APIå®¢æˆ·ç«¯
            log('ğŸ“¦ æµ‹è¯•1: æ£€æŸ¥windowå¯¹è±¡ä¸­çš„APIå®¢æˆ·ç«¯');
            log(`  window.ApiClient: ${typeof window.ApiClient}`);
            log(`  window.apiClient: ${typeof window.apiClient}`);
            log(`  window.apiClientå­˜åœ¨: ${!!window.apiClient}`);
            
            if (window.apiClient) {
                showResult('âœ… window.apiClient åŠ è½½æˆåŠŸ', 'success');
                log('âœ… APIå®¢æˆ·ç«¯å®ä¾‹å­˜åœ¨');
                
                // æµ‹è¯•2: æ£€æŸ¥APIå®¢æˆ·ç«¯å±æ€§
                log('ğŸ“‹ æµ‹è¯•2: æ£€æŸ¥APIå®¢æˆ·ç«¯å±æ€§');
                try {
                    log(`  baseUrl: ${window.apiClient.baseUrl}`);
                    log(`  token: ${window.apiClient.token ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'}`);
                    log(`  deviceId: ${window.apiClient.deviceId ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'}`);
                    log(`  initialized: ${window.apiClient.initialized}`);
                    
                    showResult('âœ… APIå®¢æˆ·ç«¯å±æ€§æ­£å¸¸', 'success');
                } catch (error) {
                    log(`âŒ æ£€æŸ¥APIå®¢æˆ·ç«¯å±æ€§å¤±è´¥: ${error.message}`);
                    showResult('âŒ APIå®¢æˆ·ç«¯å±æ€§æ£€æŸ¥å¤±è´¥: ' + error.message, 'error');
                }
                
                // æµ‹è¯•3: æ£€æŸ¥APIå®¢æˆ·ç«¯æ–¹æ³•
                log('ğŸ”§ æµ‹è¯•3: æ£€æŸ¥APIå®¢æˆ·ç«¯æ–¹æ³•');
                const methods = ['initialize', 'request', 'authenticateDevice', 'getClothingCategories', 'healthCheck'];
                let methodsOk = true;
                
                methods.forEach(method => {
                    if (typeof window.apiClient[method] === 'function') {
                        log(`  âœ… ${method}: æ–¹æ³•å­˜åœ¨`);
                    } else {
                        log(`  âŒ ${method}: æ–¹æ³•ç¼ºå¤±`);
                        methodsOk = false;
                    }
                });
                
                if (methodsOk) {
                    showResult('âœ… APIå®¢æˆ·ç«¯æ–¹æ³•å®Œæ•´', 'success');
                } else {
                    showResult('âŒ APIå®¢æˆ·ç«¯æ–¹æ³•ä¸å®Œæ•´', 'error');
                }
                
                // æµ‹è¯•4: æµ‹è¯•åˆå§‹åŒ–æ–¹æ³•
                log('ğŸ”„ æµ‹è¯•4: æµ‹è¯•åˆå§‹åŒ–æ–¹æ³•');
                try {
                    window.apiClient.initialize().then(() => {
                        log('âœ… APIå®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ');
                        showResult('âœ… APIå®¢æˆ·ç«¯åˆå§‹åŒ–æµ‹è¯•é€šè¿‡', 'success');
                    }).catch(error => {
                        log(`âš ï¸ APIå®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥: ${error.message}`);
                        showResult('âš ï¸ APIå®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥ï¼ˆä½†è¿™å¯èƒ½æ˜¯æ­£å¸¸çš„ï¼‰: ' + error.message, 'warning');
                    });
                } catch (error) {
                    log(`âŒ è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•å¤±è´¥: ${error.message}`);
                    showResult('âŒ åˆå§‹åŒ–æ–¹æ³•è°ƒç”¨å¤±è´¥: ' + error.message, 'error');
                }
                
            } else if (window.ApiClient) {
                showResult('âš ï¸ ApiClientç±»å­˜åœ¨ä½†å®ä¾‹ç¼ºå¤±ï¼Œå°è¯•æ‰‹åŠ¨åˆ›å»º', 'warning');
                log('âš ï¸ å‘ç°ApiClientç±»ä½†apiClientå®ä¾‹ç¼ºå¤±');
                
                try {
                    window.apiClient = new window.ApiClient();
                    log('âœ… æ‰‹åŠ¨åˆ›å»ºAPIå®¢æˆ·ç«¯å®ä¾‹æˆåŠŸ');
                    showResult('âœ… æ‰‹åŠ¨åˆ›å»ºAPIå®¢æˆ·ç«¯æˆåŠŸ', 'success');
                } catch (error) {
                    log(`âŒ æ‰‹åŠ¨åˆ›å»ºAPIå®¢æˆ·ç«¯å¤±è´¥: ${error.message}`);
                    showResult('âŒ æ‰‹åŠ¨åˆ›å»ºAPIå®¢æˆ·ç«¯å¤±è´¥: ' + error.message, 'error');
                }
            } else {
                showResult('âŒ APIå®¢æˆ·ç«¯æœªåŠ è½½ - api-client.jsæ–‡ä»¶å¯èƒ½æœ‰é—®é¢˜', 'error');
                log('âŒ window.ApiClient å’Œ window.apiClient éƒ½ä¸å­˜åœ¨');
                log('ğŸ” å¯èƒ½çš„åŸå› :');
                log('  1. api-client.js æ–‡ä»¶è·¯å¾„é”™è¯¯');
                log('  2. api-client.js æ–‡ä»¶è¯­æ³•é”™è¯¯');
                log('  3. è„šæœ¬åŠ è½½é¡ºåºé—®é¢˜');
                log('  4. ç½‘ç»œåŠ è½½é—®é¢˜');
                
                // æ£€æŸ¥æ˜¯å¦æœ‰JavaScripté”™è¯¯
                log('ğŸ“Š æ£€æŸ¥é¡µé¢é”™è¯¯:');
                if (window.console && window.console.error) {
                    log('  æ§åˆ¶å°é”™è¯¯æ£€æŸ¥å®Œæˆï¼Œè¯·æŸ¥çœ‹æµè§ˆå™¨å¼€å‘è€…å·¥å…·');
                }
            }
            
            log('ğŸ æµ‹è¯•å®Œæˆ');
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.addEventListener('load', () => {
            log('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆ');
            setTimeout(runTests, 100); // ç¨ç­‰ä¸€ä¸‹ç¡®ä¿æ‰€æœ‰è„šæœ¬éƒ½åŠ è½½å®Œæˆ
        });

        // ç›‘å¬é”™è¯¯
        window.addEventListener('error', (event) => {
            log(`âŒ JavaScripté”™è¯¯: ${event.message} (${event.filename}:${event.lineno})`);
            showResult('âŒ æ£€æµ‹åˆ°JavaScripté”™è¯¯ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°', 'error');
        });
    </script>
</body>
</html>